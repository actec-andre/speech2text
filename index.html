<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <title>🗣️ Sprach-Diktierer</title>
    <!-- PWA Manifest und Icons -->
    <link rel="manifest" href="manifest.json" />
    <link rel="icon" type="image/png" href="favicon.png" />
    <!-- Stlite CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@stlite/browser@0.76.0/build/style.css" />
  </head>
  <body>
    <div id="root"></div>
    <script type="module">
      import { mount } from "https://cdn.jsdelivr.net/npm/@stlite/browser@0.76.0/build/stlite.js";
      
      // Stlite-Konfiguration für unsere App
      mount(
        {
          requirements: ["streamlit-audiorecorder>=0.0.6", "pyperclip>=1.8.2", "pydub>=0.25.1"],
          entrypoint: "streamlit_app.py",
          files: {
            "streamlit_app.py": `
import streamlit as st
from audiorecorder import audiorecorder
import tempfile
import os
import base64
import pyperclip

st.set_page_config(page_title="🗣️ Sprach-Diktierer", layout="centered")
st.title("🎤 Sprache zu Text (PWA Version)")

st.write("Drücke den Button, sprich deinen Text, und lass die Spracherkennung funktionieren.")
st.warning("⚠️ Diese PWA-Version nutzt noch keine Spracherkennung, da die Whisper-Integration angepasst werden muss.")

# Konfigurationsoptionen
with st.sidebar:
    st.header("Einstellungen")
    model_type = st.selectbox(
        "Modell",
        ["tiny", "base", "small"],
        help="Größere Modelle sind genauer, aber langsamer. 'tiny' ist am schnellsten, 'small' am genauesten."
    )
    
    language = st.selectbox(
        "Hauptsprache",
        ["German", "English", "auto"],
        help="Die Hauptsprache des Diktats. 'auto' für automatische Erkennung."
    )
    
    multilingual = st.checkbox(
        "Mehrsprachig (Code/Technisch)", 
        True,
        help="Optimiert für Diktate mit gemischtem Deutsch/Englisch und Codepassagen."
    )
    
    st.info("ℹ️ Diese PWA-Demo zeigt die Benutzeroberfläche. Die Whisper-Integration wird in einem späteren Update hinzugefügt.")

# Funktion zum Erstellen eines Download-Links für Text
def get_text_download_link(text, filename="transkription.txt", link_text="📥 Text herunterladen"):
    """Generiert einen Link, um Text als Datei herunterzuladen"""
    b64 = base64.b64encode(text.encode()).decode()
    href = f'<a href="data:file/txt;base64,{b64}" download="{filename}" style="text-decoration:none;color:white;background-color:#4CAF50;padding:8px 16px;border-radius:4px;display:inline-block;text-align:center;width:100%;">{link_text}</a>'
    return href

# Demo-Audioplayer anzeigen (ohne echte Aufnahme in der PWA-Demo)
st.caption("🎙️ Aufnahme starten / 🛑 Aufnahme stoppen")
st.info("Die Audio-Aufnahme wird in der PWA-Version noch implementiert.")

# Demo-Transkription
demo_text = "Dies ist ein Demo-Text für die PWA-Version. Die echte Spracherkennung wird später implementiert."
if 'transcribed_text' not in st.session_state:
    st.session_state.transcribed_text = demo_text
    
text_area = st.text_area("📝 Transkribierter Text:", st.session_state.transcribed_text, height=200)

# Buttons-Container
col1, col2 = st.columns(2)

# Streamlit-basierter Copy-Button
with col1:
    if st.button("📋 In die Zwischenablage kopieren", key="copy_btn", use_container_width=True):
        try:
            pyperclip.copy(st.session_state.transcribed_text)
            st.success("✅ Text in die Zwischenablage kopiert!")
        except Exception as e:
            st.error(f"Fehler beim Kopieren: {str(e)}")

# Download-Button
with col2:
    st.markdown(get_text_download_link(st.session_state.transcribed_text), unsafe_allow_html=True)
`,
          },
          streamlitConfig: {
            "theme.primaryColor": "#FF4B4B",
            "theme.backgroundColor": "#FFFFFF",
            "theme.textColor": "#31333F",
            "theme.font": "sans serif",
          },
        },
        document.getElementById("root"),
      );
    </script>
    
    <!-- Service Worker für PWA -->
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/service-worker.js')
            .then(registration => console.log('Service Worker registriert:', registration))
            .catch(error => console.log('Service Worker Registrierung fehlgeschlagen:', error));
        });
      }
    </script>
  </body>
</html> 